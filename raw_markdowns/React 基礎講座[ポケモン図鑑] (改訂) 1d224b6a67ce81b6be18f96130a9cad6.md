# React 基礎講座[ポケモン図鑑] (改訂)

Tags: Reactアプリ開発基礎, ポケモン図鑑

- 目次

## Reactポケモン図鑑アプリ開発カリキュラム

専門学生向けに、TypeScript、React、Vite、React Router、Tailwind CSSなどを使用して、ポケモン図鑑アプリを開発するためのカリキュラムを作成しました。本カリキュラムでは、初心者でも理解しやすいように、詳細なコード例やコマンド、解説を含んでいます。各章の最後には振り返りのためのチェックボックスを設けていますので、学習の進捗を確認しながら進めてください。

---

## 1. はじめに

本カリキュラムでは、フロントエンド開発に必要な最新の技術スタックを使用して、実践的なポケモン図鑑アプリを作成します。以下の技術を使用します：

- **TypeScript**: JavaScriptのスーパーセットで、型安全性を提供します。
- **React**: ユーザーインターフェースを構築するためのライブラリ。
- **Vite**: 高速な開発環境を提供するビルドツール。
- **React Router**: クライアントサイドのルーティングを実現します。
- **Tailwind CSS**: ユーティリティファーストのCSSフレームワーク。
- **Tanstack Query**: データフェッチングとキャッシングのためのライブラリ。

アプリの機能として、ポケモンの一覧表示と詳細画面を日本語で提供します。また、レスポンシブデザインを採用し、モバイルファーストの実装を行います。

## 見本リポジトリ

https://github.com/wangchangdog/react-pokemon-zukan

## 見本のサイト

[ポケモン図鑑](https://wangchangdog.github.io/react-pokemon-zukan/?p=/pokemon-detail/1)

---

## 2. 開発環境の準備

### 必要なツールの確認

開発には以下のツールが必要です。Mac環境を前提としています。

1. **Node.js**: JavaScriptランタイム。最新のLTSバージョンをインストールしてください。
    - [Node.jsダウンロードページ](https://nodejs.org/)
2. **Git**: バージョン管理システム。Macには通常プリインストールされていますが、確認してください。
    
    ```bash
    git --version
    
    ```
    
3. **コードエディタ**: Visual Studio Codeを推奨します。
    - [Visual Studio Codeダウンロードページ](https://code.visualstudio.com/)

### Node.jsのインストール確認

ターミナルを開き、以下のコマンドでNode.jsがインストールされているか確認します。

```bash
node -v

```

バージョンが表示されればOKです。インストールされていない場合は、[Node.jsの公式サイト](https://nodejs.org/)からインストールしてください。

### プロジェクトディレクトリの作成

Macのユーザー名は「ktc」とします。学籍番号を仮に「学籍番号」とすると、以下のようにディレクトリを作成します。

```bash
mkdir /Users/ktc/学籍番号
cd /Users/ktc/学籍番号

```

---

## 3. GitHubリポジトリの作成

### GitHubアカウントの作成

GitHubアカウントを持っていない場合は、[GitHubの公式サイト](https://github.com/)からアカウントを作成してください。

### 新しいリポジトリの作成

1. GitHubにログインし、右上の「＋」アイコンをクリックして「New repository」を選択します。
2. リポジトリ名を「react-pokemon-zukan」と入力します。
3. 「Public」を選択します。
4. 「Add a README file」にチェックを入れて「Create repository」をクリックします。

---

## 4. Viteプロジェクトのセットアップ

Viteは高速なビルドツールで、Reactプロジェクトのセットアップに最適です。

### プロジェクトのディレクトリに移動

```racket
mkdir ~/学籍番号
cd ~/学籍番号
```

### プロジェクトの作成

以下のコマンドを実行して、Viteを使用してReact + TypeScriptプロジェクトを作成します。

```bash
npm create vite@latest react-pokemon-zukan -- --template react-ts

```

### ディレクトリに移動して依存関係をインストール

```bash
cd react-pokemon-zukan
npm install

```

### ローカルリポジトリの設定

ターミナルで以下のコマンドを実行して、ローカルリポジトリをGitHubに接続します。

```bash
# https://github.com/<your-username>/react-pokemon-zukan.git にはリポジトリのURLが入ります
git init
git remote add origin https://github.com/<your-username>/react-pokemon-zukan.git

```

*注: `your-username`をあなたのGitHubユーザー名に置き換えてください。*

### Gitの設定

Gitのユーザー名とメールアドレスを設定します。

```bash
git config --local user.name "Your Name"
git config --local user.email "your.email@example.com"

```

### ターミナルからGitHubへのログイン

```jsx
gh auth logout 
gh auth login

```

下のスクショのように選択肢を選択

![スクリーンショット 2024-10-05 11.55.28.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-05_11.55.28.png)

何らかのキーを押すと以下の画面に飛ばされます。
GitHubにログインしていない場合はログインが求められます。

![スクリーンショット 2024-10-05 11.56.05.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-05_11.56.05.png)

Continue を押す

![スクリーンショット 2024-10-05 11.56.56.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-05_11.56.56.png)

### GitHubへの初回プッシュ

作成したプロジェクトをGitHubにプッシュします。

```bash
git add .
git commit -m "Set up Vite React TypeScript project"
git push -uf origin main

```

### プロジェクトの起動確認

開発サーバーを起動して、プロジェクトが正しくセットアップされているか確認します。

```bash
npm run dev
```

ブラウザで `http://localhost:5173` にアクセスし、Viteのウェルカムページが表示されればOKです。

---

## 5. TypeScriptとReactの基本(説明のみ、ファイル追加は不要)

### TypeScriptの基本

TypeScriptはJavaScriptに型を追加した言語です。型を使用することで、コードの品質と保守性を向上させます。

### 例: 型定義

```tsx
// 関数の引数と戻り値に型を定義
function greet(name: string): string {
  return `Hello, ${name}!`;
}

const message: string = greet("ポケモンマスター");
console.log(message); // 出力: Hello, ポケモンマスター!

```

### Reactの基本

Reactはコンポーネントベースのライブラリで、ユーザーインターフェースを構築します。

### 関数コンポーネントの例

```tsx
import React from 'react';

type GreetingProps = {
  name: string;
};

const Greeting: React.FC<GreetingProps> = ({ name }) => {
  return <h1>Hello, {name}!</h1>;
};

export default Greeting;

```

### 使用例

```tsx
import React from 'react';
import Greeting from './Greeting';

const App: React.FC = () => {
  return (
    <div>
      <Greeting name="ポケモンマスター" />
    </div>
  );
};

export default App;

```

### JSXとTypeScriptの連携(例)

TypeScriptを使用すると、JSX内での型安全性が向上します。

```tsx
import React from 'react';

type PokemonProps = {
  id: number;
  name: string;
  image: string;
};

const PokemonCard: React.FC<PokemonProps> = ({ id, name, image }) => {
  return (
    <div className="pokemon-card">
      <img src={image} alt={name} />
      <h2>{id}. {name}</h2>
    </div>
  );
};

export default PokemonCard;

```

---

## 6. React Routerの導入

React Routerを使用して、アプリケーション内でページ遷移を実現します。

### React Routerのインストール

```bash
npm install react-router-dom

```

### 基本的なルーティングの設定

`src/main.tsx`を編集して、`BrowserRouter`を追加します。

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App';
import './index.css';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);

```

### ルートの定義

`src/App.tsx`を編集して、ルートを定義します。

```tsx
import React from 'react';
import { Routes, Route } from 'react-router-dom';
import PokemonList from './pages/PokemonList';
import PokemonDetail from './pages/PokemonDetail';

const App: React.FC = () => {
  return (
    <Routes>
      <Route path="/" element={<PokemonList />} />
      <Route path="/pokemon/:id" element={<PokemonDetail />} />
    </Routes>
  );
};

export default App;

```

### ページコンポーネントの作成

`src/pages`ディレクトリを作成し、`PokemonList.tsx`と`PokemonDetail.tsx`を追加します。

```bash
mkdir src/pages
touch src/pages/PokemonList.tsx src/pages/PokemonDetail.tsx

```

今は仮のコンポーネントとして、

`PokemonList.tsx`と`PokemonDetail.tsx`には後述の内容を実装します。

`PokemonList.tsx` 

```tsx
const PokemonList: React.FC = () => {
    return (
      <div className="text-center mt-10">
        <h1 className="text-4xl font-bold text-blue-500">Reactポケモン図鑑リスト</h1>
      </div>
    )
}

export default PokemonList;
```

`PokemonDetail.tsx`

```tsx
const PokemonDetail: React.FC = () => {
    return (
      <div className="text-center mt-10 bg-slate-500">
        <h1 className="text-4xl font-bold text-blue-500">Reactポケモン図鑑詳細</h1>
        <div className="bg-slate-500">
          ここにポケモンの画像やステータスなどを表示する。
        </div>
      </div>
    )
}

export default PokemonDetail;
```

---

## 7. Tailwind CSSの設定とグローバルconfigなどの追加

### Tailwind CSSのインストールと設定

[Tailwind CSSとは？](https://www.notion.so/Tailwind-CSS-1d224b6a67ce814695cae3fc4b261b1b?pvs=21) 

Tailwind CSSをプロジェクトに導入します。

```bash
npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p

```

`tailwind.config.js`を以下のように編集します。

```jsx
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}

```

`src/index.css`を以下の内容に置き換えます。

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

```

### Tailwind CSSの動作確認

`http://localhost:5173`  が動いているか確認し、Tailwind CSSが正しく動作するか確認します。

### pokemonTypesMap.tsの作成

```tsx
// src/pokemonTypesMap.ts
// ポケモンのタイプと色を対応させる
export const pokemonTypesMap = [
  {
    type: 'normal',
    jaType: 'ノーマル',
    color: '#A8A878',
  },
  {
    type: 'fire',
    jaType: 'ほのお',
    color: '#F08030',
  },
  {
    type: 'water',
    jaType: 'みず',
    color: '#6890F0',
  },
  {
    type: 'electric',
    jaType: 'でんき',
    color: '#F8D030',
  },
  {
    type: 'grass',
    jaType: 'くさ',
    color: '#78C850',
  },
  {
    type: 'ice',
    jaType: 'こおり',
    color: '#98D8D8',
  },
  {
    type: 'fighting',
    jaType: 'かくとう',
    color: '#C03028',
  },
  {
    type: 'poison',
    jaType: 'どく',
    color: '#A040A0',
  },
  {
    type: 'ground',
    jaType: 'じめん',
    color: '#E0C068',
  },
  {
    type: 'flying',
    jaType: 'ひこう',
    color: '#A890F0',
  },
  {
    type: 'psychic',
    jaType: 'エスパー',
    color: '#F85888',
  },
  {
    type: 'bug',
    jaType: 'むし',
    color: '#A8B820',
  },
  {
    type: 'rock',
    jaType: 'いわ',
    color: '#B8A038',
  },
  {
    type: 'ghost',
    jaType: 'ゴースト',
    color: '#705898',
  },
  {
    type: 'dragon',
    jaType: 'ドラゴン',
    color: '#7038F8',
  },
  {
    type: 'dark',
    jaType: 'あく',
    color: '#705848',
  },
  {
    type: 'steel',
    jaType: 'はがね',
    color: '#B8B8D0',
  },
  { 
    type: 'fairy',
    jaType: 'フェアリー',
    color: '#F0A0C0',
  }
]
```

---

## 8. PokeAPIの利用方法（更新）

PokeAPIは、ポケモンに関するデータを提供するRESTful APIです。詳細なドキュメントは [PokeAPI v2 Documentation](https://pokeapi.co/docs/v2) を参照してください。

### PokeAPIのエンドポイント

- **ポケモン一覧**: `https://pokeapi.co/api/v2/pokemon?limit=100&offset=0`
- **ポケモン詳細**: `https://pokeapi.co/api/v2/pokemon/{id}`
- **ポケモン種族情報**: `https://pokeapi.co/api/v2/pokemon-species/{id}`

### APIデータの取得方法

以下に、`fetch`を使用してポケモン一覧を取得し、日本語名を取得する方法を示します。参考にした方法については、[Zennの記事](https://zenn.dev/h_aso/articles/2220c857f5b74c)を参照してください。

```tsx
mkdir src/api
touch src/api/pokemon.ts src/api/pokemonSpecies.ts src/api/pokemonWithJapaneseName.ts

```

### APIレスポンスの型定義

このままではAPIリクエストのレスポンスの型がないので、以下のように作成する

共通の型 `src/api/common.type.ts` 

```tsx
// src/api/common.type.ts

export interface NamedAPIResource {
  name: string;
  url: string;
}

export interface Name {
  name: string;
  language: NamedAPIResource;
}

export interface APIResource {
  url: string;
}
```

`src/api/pokemon.type.ts`  

```tsx
// src/api/pokemon.type.ts

import { Name, NamedAPIResource } from './common.type';

export interface PokemonSprites {
  front_default: string | null;
  front_shiny: string | null;
  front_female: string | null;
  front_shiny_female: string | null;
  back_default: string | null;
  back_shiny: string | null;
  back_female: string | null;
  back_shiny_female: string | null;
}

export interface PokemonType {
  slot: number;
  type: NamedAPIResource;
}

export interface PokemonAbility {
  is_hidden: boolean;
  slot: number;
  ability: NamedAPIResource;
}

export interface VersionGameIndex {
  game_index: number;
  version: NamedAPIResource;
}

export interface VersionDetail {
  rarity: number;
  version: NamedAPIResource;
}

export interface PokemonHeldItem {
  item: NamedAPIResource;
  version_details: VersionDetail[];
}

export interface PokemonMove {
  move: NamedAPIResource;
  version_group_details: VersionDetail[];
}

export interface PokemonStat {
  stat: NamedAPIResource;
  effort: number;
  base_stat: number;
}

export interface PokemonType {
  slot: number;
  type: NamedAPIResource;
}

export interface FlavorTextEntry {
  flavor_text: string;
  language: NamedAPIResource;
}

export interface Pokemon {
  id: number;
  name: string;
  base_experience: number;
  height: number;
  is_default: boolean;
  order: number;
  weight: number;
  abilities: PokemonAbility[];
  forms: NamedAPIResource[];
  game_indices: VersionGameIndex[];
  held_items: PokemonHeldItem[];
  location_area_encounters: string;
  moves: PokemonMove[];
  sprites: PokemonSprites;
  species: NamedAPIResource;
  stats: PokemonStat[];
  types: PokemonType[];
}

export interface TypeRelations {
  double_damage_from: NamedAPIResource[];
  double_damage_to: NamedAPIResource[];
  half_damage_from: NamedAPIResource[];
  half_damage_to: NamedAPIResource[];
  no_damage_from: NamedAPIResource[];
  no_damage_to: NamedAPIResource[];
}

export interface GenerationGameIndex {
  game_index: number;
  generation: NamedAPIResource;
}

export interface TypePokemon {
  slot: number;
  pokemon: NamedAPIResource;
}

export interface Type {
  id: number;
  name: string;
  damage_relations: TypeRelations;
  game_indices: GenerationGameIndex[];
  generation: NamedAPIResource;
  move_damage_class: NamedAPIResource;
  names: Name[];
  pokemon: TypePokemon[];
  moves: NamedAPIResource[];
}

// 他のタイプ関連の型も同様に定義
```

### 1. ポケモン一覧の取得

```tsx
// src/api/pokemon.ts
import { API_BASE_URL } from '../config';

export interface PokemonListResult {
  count: number;
  next: string | null;
  previous: string | null;
  results: {
    name: string;
    url: string;
  }[];
}

export const fetchPokemonList = async (offset: number = 20, limit: number = 20): Promise<PokemonListResult> => {
  const response = await fetch(`${API_BASE_URL}/pokemon?offset=${offset}&limit=${limit}`);
  if (!response.ok) {
    throw new Error('ポケモン一覧の取得に失敗しました');
  }
  const data = await response.json();
  return data;
};

```

### 2. ポケモンの日本語名を取得する関数の作成

各ポケモンの`species.url`を使用して、日本語名を取得します。

```tsx
// src/api/pokemonSpecies.ts
type SpeciesName = {
  name: string;
  language: {
    name: string;
    url: string;
  };
};

type SpeciesData = {
  names: SpeciesName[];
};

export const fetchPokemonJapaneseName = async (speciesUrl: string): Promise<string> => {
  try {
    const response = await fetch(speciesUrl);
    if (!response.ok) {
    throw new Error('ポケモン種族情報の取得に失敗しました');
  }
    const data: SpeciesData = await response.json();
    const japaneseNameEntry = data.names.find(nameEntry => nameEntry.language.name === 'ja-Hrkt');
    return japaneseNameEntry ? japaneseNameEntry.name : data.names[0].name;
  } catch (error) {
    console.error('ポケモン種族情報の取得に失敗しました', error);
    return '名前不明';
  }
};

```

### 3. ポケモン一覧に日本語名を追加する

ポケモン一覧を取得した後、各ポケモンの日本語名を取得してデータに追加します。

```tsx
// src/api/pokemonWithJapaneseName.ts
import { INITIAL_POKEMON_LIST_LIMIT } from '../config';
import { fetchPokemonList, PokemonListResult } from './pokemon';
import { Pokemon } from './pokemon.type';
import { fetchPokemonJapaneseName } from './pokemonSpecies';

// ポケモンの日本語名を含む拡張情報を表す型
export type PokemonWithJapaneseName = {
  name: string;          // ポケモンの英語名
  url: string;           // ポケモンの詳細情報を取得するためのURL
  japaneseName: string;  // ポケモンの日本語名
  number: string;        // ポケモンの図鑑番号
};

// 日本語名を含むポケモンリストの結果を表す型
export type PokemonListWithJapaneseNames = {
  count: number;                         // 総ポケモン数
  next: string | null;                   // 次のページのURL（存在する場合）
  previous: string | null;               // 前のページのURL（存在する場合）
  results: PokemonWithJapaneseName[];    // ポケモンの詳細情報リスト
};

// 日本語名を含むポケモンリストを取得する関数
export const fetchPokemonListWithJapaneseNames = async (offset: number = 0, limit: number = INITIAL_POKEMON_LIST_LIMIT): Promise<PokemonListWithJapaneseNames> => {
  // 基本的なポケモンリストを取得
  const pokemonList: PokemonListResult = await fetchPokemonList(offset, limit);
  
  // 各ポケモンの詳細情報を取得し、日本語名を追加
  const updatedResults: PokemonWithJapaneseName[] = await Promise.all(
    pokemonList.results.map(async (pokemon) => {
      // ポケモン種族のURLを生成
      const speciesUrl = pokemon.url.replace('https://pokeapi.co/api/v2/pokemon/', 'https://pokeapi.co/api/v2/pokemon-species/');
      // 日本語名を取得
      const japaneseName = await fetchPokemonJapaneseName(speciesUrl);
      // ポケモンの詳細情報を取得
      const pokemonDetails: Pokemon = await fetch(pokemon.url).then(res => res.json());
      
      // 必要な情報を組み合わせて返す
      return {
        ...pokemon,
        japaneseName,
        number: pokemonDetails.id.toString(),
        types: pokemonDetails.types.map((t) => ({
          type: {
            name: t.type.name
          }
        })),
        abilities: pokemonDetails.abilities.map((a) => ({
          ability: {
            name: a.ability.name
          }
        }))
      };
    })
  );
  
  // 元のリスト情報と更新された結果を組み合わせて返す
  return { ...pokemonList, results: updatedResults };
};

```

**注意点**: ポケモンの数が多い場合、複数のAPIリクエストが発生するため、パフォーマンスに注意が必要です。必要に応じて、キャッシングやバッチ処理を検討してください。

### グローバルコンフィグを src/config.tsに作成

```tsx
// src/config.ts

const API_BASE_URL = 'https://pokeapi.co/api/v2';

const INITIAL_POKEMON_LIST_LIMIT = 40;

export { API_BASE_URL, INITIAL_POKEMON_LIST_LIMIT };
```

---

## 9. Tanstack Queryの導入

### Tanstack Queryのインストール

Tanstack Query（旧称React Query）は、データフェッチングとキャッシングを効率的に管理するライブラリです。

```bash
npm install @tanstack/react-query

```

### Tanstack Queryの設定

`src/main.tsx`を編集して、`QueryClient`と`QueryClientProvider`を設定します。

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import App from './App';
import './index.css';

const queryClient = new QueryClient();

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </QueryClientProvider>
  </React.StrictMode>
);

```

### クエリキーの管理

クエリキーは、データのキャッシングと識別に使用されます。`src/queryKeys.ts`を作成し、クエリキーを管理します。

query-key-factoryを使用して、クエリキーの管理を効率化します。

```bash
npm install @lukemorales/query-key-factory
```

```tsx
// src/queryKeys.ts
import { createQueryKeys, mergeQueryKeys } from "@lukemorales/query-key-factory";

export const pokemonQueryKeys = createQueryKeys("pokemon", {
    list: () => ["list"],
    detail: (id: number) => ["detail", id],
});

export const apiQueryKeys = mergeQueryKeys(pokemonQueryKeys);
```

---

## 10. ポケモン一覧画面の作成

### ディレクトリ構成

`src/pages/PokemonList.tsx`を編集します。

### PokemonListコンポーネントの実装

```tsx
// src/pages/PokemonList.tsx
import React, { useEffect, useRef } from 'react';
import { useInfiniteQuery } from '@tanstack/react-query';
import { apiQueryKeys } from '../queryKeys';
import { fetchPokemonListWithJapaneseNames, PokemonWithJapaneseName } from '../api/pokemonWithJapaneseName';
import PokemonCard from '../components/PokemonCard';
import Skeleton from 'react-loading-skeleton';
import 'react-loading-skeleton/dist/skeleton.css';

const PokemonList: React.FC = () => {
  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    status,
    isLoading,
  } = useInfiniteQuery({
    queryKey: [apiQueryKeys.pokemon.list()],
    queryFn: ({ pageParam = 0 }) => fetchPokemonListWithJapaneseNames(pageParam),
    initialPageParam: 0,
    getNextPageParam: (lastPage, pages) => {
      if (lastPage.next) {
        return pages.length * 20;
      }
      return undefined;
    },
  });

  const loadMoreRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting && hasNextPage && !isFetchingNextPage) {
          fetchNextPage();
        }
      },
      { threshold: 1.0 }
    );

    if (loadMoreRef.current) {
      observer.observe(loadMoreRef.current);
    }

    return () => observer.disconnect();
  }, [fetchNextPage, hasNextPage, isFetchingNextPage]);

  if (isLoading) return <PokemonListSkeleton />;
  if (status === 'error') return <div>エラーが発生しました</div>;

  return (
    <div className="p-4">
      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {data?.pages.map((page) =>
          page.results.map((pokemon: PokemonWithJapaneseName) => (
            <PokemonCard key={pokemon.name} pokemon={pokemon} />
          ))
        )}
      </div>
      <div ref={loadMoreRef} className="h-20 flex items-center justify-center">
        {isFetchingNextPage ? <Loader /> : hasNextPage ? '続きを読み込む' : ''}
      </div>
    </div>
  );
};

// ローダーコンポーネント
const Loader: React.FC = () => (
  <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"></div>
);

const PokemonListSkeleton: React.FC = () => {
  return (
    <div className="p-4">
      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
        {[...Array(18)].map((_, index) => (
          <div key={index} className="bg-white shadow-md rounded-lg p-4">
            <Skeleton height={120} />
            <Skeleton width={80} height={20} className="mt-2" />
            <Skeleton width={100} height={16} className="mt-1" />
          </div>
        ))}
      </div>
      <div className="h-10 flex items-center justify-center">
        <Skeleton width={100} height={20} />
      </div>
    </div>
  );
};

export default PokemonList;

```

### API関数の実装

`src/api/pokemonWithJapaneseName.ts`を作成し、API連携の処理を集約します（前述のセクション8を参照）。

### PokemonCardコンポーネントの実装(componentsフォルダ)

`src/components/PokemonCard.tsx`を作成します。

```tsx
// src/components/PokemonCard.tsx
import React from 'react';
import { Link } from 'react-router-dom';

export type PokemonDetail = {
  name: string;
  url: string;
  japaneseName: string;
  number: string;
}

type PokemonCardProps = {
  pokemon: PokemonDetail;
};

const PokemonCard: React.FC<PokemonCardProps> = ({ pokemon }) => {
  const id = pokemon.url.split('/').filter(Boolean).pop();
  const imageUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;

  return (
    <Link to={`/pokemon/${id}`}>
      <div className="bg-white shadow-md rounded-lg p-4 flex flex-col items-center hover:shadow-xl transition-shadow">
        <p className="text-sm text-gray-500 mr-auto">No. {pokemon.number}</p>
        <img src={imageUrl} alt={pokemon.japaneseName} className="w-20 h-20" />
        <h2 className="mt-2 text-lg font-semibold">{pokemon.japaneseName}</h2>
      </div>
    </Link>
  );
};

export default PokemonCard;

```

---

## 11. ポケモン詳細画面の作成

### PokemonTypeLabelコンポーネント

`src/components/PokemonTypeLabel.tsx`  を作成する。

```tsx
// src/components/pokemonTypeLabel.tsx
// ポケモンのタイプのラベル
import { pokemonTypesMap } from '../pokemonTypesMap';

type PokemonTypeLabelProps = {
  type: string;
};

const PokemonTypeLabel: React.FC<PokemonTypeLabelProps> = ({ type }) => {
  const typeInfo = pokemonTypesMap.find((t) => t.jaType === type);
  return (
    <span 
      style={{
        backgroundColor: typeInfo?.color,
      }}
      key={type}
      className={`text-white px-3 py-1 rounded-full w-fit`}
    >
      {typeInfo?.jaType}
    </span>
  );
};

export default PokemonTypeLabel;
```

### PokemonDetailコンポーネントの実装

`src/pages/PokemonDetail.tsx`を編集します。

```tsx
// src/pages/PokemonDetail.tsx
import { useQuery } from '@tanstack/react-query';
import React, { useEffect } from 'react';
import { Link, useParams } from 'react-router-dom';
import { fetchPokemonDetail } from '../api/pokemonDetail';
import PokemonTypeLabel from '../components/PokemonTypeLabel';
import { apiQueryKeys } from '../queryKeys';
import Skeleton from 'react-loading-skeleton';
import 'react-loading-skeleton/dist/skeleton.css';

const PokemonDetail: React.FC = () => {
  const { id } = useParams<{ id: string }>();

  const { data, isLoading, error } = useQuery({
    queryKey: [apiQueryKeys.pokemon.detail(Number(id))],
    queryFn: () => fetchPokemonDetail(Number(id)),
    enabled: !!id,
  });

  useEffect(() => {
    console.log(data);
  }, [data])

  if (isLoading) return <PokemonDetailSkeleton />;
  if (error instanceof Error) return <div>エラー: {error.message}</div>;
  if (!data) return <div>ポケモンが見つかりません</div>;

  return (
    <div className="p-4 max-w-[400px] m-auto">
      <Link to="/" className="px-4 py-2 bg-blue-500 text-white rounded-md mb-4">← 一覧に戻る</Link>
      <div className="mt-4 bg-white shadow-md rounded p-8 flex flex-col items-center gap-4">
        <img src={data.image} alt={data.japaneseName} className="w-40 h-40" />
        <h1 className="mt-4 text-2xl font-bold">{data.japaneseName} (#{data.id})</h1>
        <p className="mt-2 text-justify">{data.description}</p>
        <div className="grid grid-cols-2 gap-2">
          {data?.types?.map((type) => (
            <PokemonTypeLabel key={type} type={type} />
          ))}
        </div>
          <span className="w-fit whitespace-nowrap text-right">特性</span>
        <div className="flex gap-2">
          <div className="grid grid-cols-2 gap-2 w-full">
            {data?.abilities?.map((ability) => (
              <span key={ability}>{ability}</span>
            ))}
          </div>
        </div>
        <div className="mt-4 grid grid-cols-1 gap-x-2 w-full">
          {data?.baseStats?.map((stat) => (
            <div key={stat.name} className="flex items-center">
              <span className="w-24 text-right mr-2">{stat.name}</span>
              <div className="flex-1 bg-gray-200 rounded-full h-4">
                <div
                  className="bg-blue-600 rounded-full h-4"
                  style={{ width: `${(stat.value / 255) * 100}%` }}
                ></div>
              </div>
              <span className="ml-2 w-8">{stat.value}</span>
            </div>
          ))}
          {/* 合計種族値 */}
          <div className="flex items-center">
            <span className="w-24 text-right mr-2">合計</span>
            <div className="flex-1 bg-gray-200 rounded-full h-4">
              <div
                className="bg-blue-600 rounded-full h-4"
                style={{ width: `${(data?.baseStats?.reduce((sum, stat) => sum + stat.value, 0) / 780) * 100}%` }}
              ></div>
            </div>
            <span className="ml-2 w-8">{data?.baseStats?.reduce((sum, stat) => sum + stat.value, 0)}</span>
          </div>
        </div>
      </div>
      <div className="mt-4 flex justify-between">
        {/* 0は前へがないので非表示 */}
        {Number(id) !== 1 ? <Link to={`/pokemon/${Number(id) - 1}`} className="px-4 py-2 bg-blue-500 text-white rounded-md">前へ</Link> : <span />}
        <Link to={`/pokemon/${Number(id) + 1}`} className="px-4 py-2 bg-blue-500 text-white rounded-md">次へ</Link>
      </div>
    </div>
  );
};

const PokemonDetailSkeleton: React.FC = () => {
  return (
    <div className="p-4 max-w-[400px] m-auto">
      <div className="px-4 py-2 bg-blue-500 text-white rounded-md mb-4 w-24">
        <Skeleton />
      </div>
      <div className="mt-4 bg-white shadow-md rounded p-8 flex flex-col items-center gap-4">
        <Skeleton circle={true} width={160} height={160} />
        <Skeleton width={200} height={24} />
        <Skeleton width={300} height={60} />
        <div className="grid grid-cols-2 gap-2 w-full">
          <Skeleton width={100} height={24} />
          <Skeleton width={100} height={24} />
        </div>
        <div className="grid grid-cols-2 gap-2 w-full">
          <Skeleton width={100} height={24} />
          <Skeleton width={100} height={24} />
        </div>
        <div className="mt-4 grid grid-cols-1 gap-x-2 w-full">
          {[...Array(6)].map((_, index) => (
            <div key={index} className="flex items-center">
              <Skeleton width={60} height={20} />
              <div className="flex-1 ml-2">
                <Skeleton height={20} />
              </div>
            </div>
          ))}
        </div>
      </div>
      <div className="mt-4 flex justify-between">
        <Skeleton width={80} height={36} />
        <Skeleton width={80} height={36} />
      </div>
    </div>
  );
};

export default PokemonDetail;

```

### スケルトンの実装

スケルトンを実装します。

スケルトンとは以下のようなローディング時に表示されるオブジェクトです

![スクリーンショット 2024-10-12 11.06.17.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-12_11.06.17.png)

```bash
npm install react-loading-skeleton
```

### API関数の実装

`src/api/pokemonDetail.ts`を作成します。

```tsx
// src/api/pokemonDetail.ts
import { FlavorTextEntry, PokemonAbility, PokemonStat, PokemonType } from './pokemon.type';
import { Name } from './common.type';

type PokemonDetail = {
  id: number;
  name: string;
  japaneseName: string;
  image: string;
  types: string[];
  abilities: string[];
  description: string;
  baseStats: { name: string; value: number }[];
};

export const fetchPokemonDetail = async (id: number): Promise<PokemonDetail> => {
  const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
  if (!response.ok) {
    throw new Error('ポケモンの詳細情報の取得に失敗しました');
  }
  const data = await response.json();

  // ポケモン種族情報を取得して日本語名を取得
  const speciesResponse = await fetch(data.species.url);
  if (!speciesResponse.ok) {
    throw new Error('ポケモン種族情報の取得に失敗しました');
  }
  const speciesData = await speciesResponse.json();
  const japaneseNameEntry = speciesData.names.find(
    (nameEntry: Name) => nameEntry.language.name === 'ja'
  );
  const japaneseName = japaneseNameEntry ? japaneseNameEntry.name : data.name;

  // タイプの日本語名を取得
  const types = await Promise.all(
    data.types.map(async (typeInfo: PokemonType) => {
      const typeResponse = await fetch(typeInfo.type.url);
      const typeData = await typeResponse.json();
      const japaneseType = typeData.names.find((name: Name) => name.language.name === 'ja');
      return japaneseType ? japaneseType.name : typeInfo.type.name;
    })
  );

  // 特性の日本語名を取得
  const abilities = await Promise.all(
    data.abilities.map(async (abilityInfo: PokemonAbility) => {
      const abilityResponse = await fetch(abilityInfo.ability.url);
      const abilityData = await abilityResponse.json();
      const japaneseAbility = abilityData.names.find((name: Name) => name.language.name === 'ja');
      return japaneseAbility ? japaneseAbility.name : abilityInfo.ability.name;
    })
  );

  // 種族値の取得
  const baseStats = await Promise.all(data.stats.map( async (stat: PokemonStat) => {
    // 日本語名を取得
    const japaneseStatData = await fetch(`https://pokeapi.co/api/v2/stat/${stat.stat.name}`);
    const japaneseStatDataJson = await japaneseStatData.json();
    return {
      name: japaneseStatDataJson.names.find((name: Name) => name.language.name === "ja-Hrkt").name,
      value: stat.base_stat,
    };
  }));

  console.log(baseStats);

  // 説明文の取得
  const flavorTextEntry = speciesData.flavor_text_entries.find(
    (entry: FlavorTextEntry) => entry.language.name === 'ja'
  );
  const description = flavorTextEntry
    ? flavorTextEntry.flavor_text.replace(/\f/g, ' ')
    : '説明文がありません。';

  return {
    id: data.id,
    name: data.name,
    japaneseName,
    image: data.sprites.other['official-artwork'].front_default,
    types,
    abilities,
    description,
    baseStats,
  };
};

```

**説明**:

1. **ポケモン詳細の取得**: `https://pokeapi.co/api/v2/pokemon/{id}`エンドポイントからポケモンの基本情報を取得します。
2. **種族情報の取得**: 取得したポケモンデータの`species.url`を使用して、種族情報を取得します。
3. **日本語名の抽出**: `speciesData.names`配列から`language.name`が`ja-Hrkt`のエントリーを見つけ、その`name`を日本語名として使用します。
4. **説明文の抽出**: `speciesData.flavor_text_entries`配列から`language.name`が`ja-Hrkt`のエントリーを見つけ、その`flavor_text`を説明文として使用します。改行コード（`\\f`）をスペースに置換しています。

**参考**: 詳細な実装方法については、[Zennの記事](https://zenn.dev/h_aso/articles/2220c857f5b74c)を参照してください。

---

## 12. レスポンシブデザインの実装

### Header, Navigation, Footerの作成

`src/components`ディレクトリに`Header.tsx`、`Navigation.tsx`、`Footer.tsx`を作成します。

### Headerコンポーネント

```tsx
// src/components/Header.tsx
import React from 'react';
import { Link } from 'react-router-dom';
import logo from '../assets/logo.svg';

const Header: React.FC = () => {
  return (
    <header className="bg-blue-500 text-white p-4">
      <h1 className="text-2xl">
        <Link to="/" className="inline-flex items-center gap-2 text-decoration-none">
          <img 
            src={logo} 
            alt="モンスターボールのアイコン" 
            className="w-10 h-10"
          />
          ポケモン図鑑
        </Link>
      </h1>
    </header>
  );
};

export default Header;

```

`assets/logo.svg` 

```tsx
<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 20.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.1" id="Pokéball" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 595.3 594.1" style="enable-background:new 0 0 595.3 594.1;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#FFFFFF;}
	.st1{fill:#DFDFDF;}
	.st2{fill:#FF1C1C;}
	.st3{fill:#DF1818;}
</style>
<g id="Pokéball_1_">
	<g id="Colours">
		<path id="Down" class="st0" d="M297.6,380.9c-40.4,0-74.1-28.6-82.1-66.6H81.1c9.5,110.5,102.2,197.2,215.1,197.2
			s205.7-86.7,215.1-197.2H379.7C371.7,352.4,338,380.9,297.6,380.9z"/>
		<path id="Shadow_Down" class="st1" d="M345.6,505.9c89.6-21,157.7-97.7,165.7-191.6h-53C453,399.5,408.3,471.7,345.6,505.9z"/>
		<path id="Center" class="st0" d="M347.1,297L347.1,297C347,297,347,297,347.1,297c-0.1-6.1-1.2-11.9-3.2-17.3
			c-7-18.8-25.1-32.1-46.3-32.1s-39.3,13.4-46.3,32.1c-2,5.4-3.1,11.2-3.1,17.3c0,0,0,0,0,0h0.1c0,0,0,0,0,0
			c0,6.1,1.1,11.9,3.1,17.3c7,18.8,25.1,32.1,46.3,32.1c21.2,0,39.3-13.4,46.3-32.1C346,309,347.1,303.1,347.1,297
			C347.1,297,347.1,297,347.1,297z"/>
		<path id="Up" class="st2" d="M297.7,213.2c40.4,0,74.1,28.6,82.1,66.6h134.4C504.7,169.2,412,82.5,299,82.5S93.4,169.2,83.9,279.7
			h131.7C223.6,241.7,257.3,213.2,297.7,213.2z"/>
		<path id="Shadow_Up" class="st3" d="M458.3,279.7h55.8c-8.2-95.5-78.6-173.3-170.5-192.6C407.4,120.8,452.9,193.7,458.3,279.7z"/>
	</g>
	<path id="Line" d="M299,82.5c113,0,205.7,86.7,215.1,197.2H379.7c-8-38-41.7-66.6-82.1-66.6c-40.4,0-74.1,28.6-82.1,66.6H83.9
		C93.4,169.2,186.1,82.5,299,82.5z M343.9,279.7c2,5.4,3.1,11.2,3.1,17.3c0,0,0,0,0,0h0.1c0,0,0,0,0,0c0,6.1-1.1,11.9-3.1,17.3
		c-7,18.8-25.1,32.1-46.3,32.1c-21.2,0-39.3-13.4-46.3-32.1c-2-5.4-3.1-11.2-3.1-17.3c0,0,0,0,0,0h-0.1c0,0,0,0,0,0
		c0-6.1,1.1-11.9,3.1-17.3c7-18.8,25.1-32.1,46.3-32.1S336.9,261,343.9,279.7z M296.2,511.6c-113,0-205.7-86.7-215.1-197.2h134.4
		c8,38,41.7,66.6,82.1,66.6s74.1-28.6,82.1-66.6h131.7C501.9,424.8,409.2,511.6,296.2,511.6z M297.6,41.3
		C156.4,41.3,41.9,155.8,41.9,297s114.5,255.7,255.7,255.7S553.4,438.3,553.4,297S438.9,41.3,297.6,41.3z"/>
</g>
</svg>

```

### Navigationコンポーネント

```tsx
// src/components/Navigation.tsx
import React from 'react';
import { Link } from 'react-router-dom';

const Navigation: React.FC = () => {
  const pathname = window.location.pathname;

  return (
    <nav className="bg-gray-100 p-4">
      <ul className="flex space-x-4">
        {/* 一覧画面の場合は一覧ボタンを非表示 */}
        {
          pathname !== '/' && (
            <li>
              <Link to="/" className="text-blue-500 hover:underline text-decoration-none">{"< "}一覧</Link>
            </li>
          )
        }
        {/* 追加のナビゲーションリンクをここに記載 */}
      </ul>
    </nav>
  );
};

export default Navigation;

```

### Footerコンポーネント

```tsx
// src/components/Footer.tsx
import React from 'react';

const Footer: React.FC = () => {
  return (
    <footer className="bg-gray-200 text-center p-4 mt-8">
      <p>&copy; 2024 Reactポケモン図鑑</p>
    </footer>
  );
};

export default Footer;

```

### Appコンポーネントの編集

`src/App.tsx`を編集し、Header、Navigation、Footerを追加します。

```tsx
import React from 'react';
import { Routes, Route } from 'react-router-dom';
import PokemonList from './pages/PokemonList';
import PokemonDetail from './pages/PokemonDetail';
import Header from './components/Header';
import Navigation from './components/Navigation';
import Footer from './components/Footer';

const App: React.FC = () => {
  return (
    <div className="flex flex-col min-h-screen">
      <Header />
      <Navigation />
      <main className="flex-grow">
        <Routes>
          <Route path="/" element={<PokemonList />} />
          <Route path="/pokemon/:id" element={<PokemonDetail />} />
        </Routes>
      </main>
      <Footer />
    </div>
  );
};

export default App;

```

---

## 13.  GitHub Pagesへのデプロイ (追加)

### GitHub Pagesのセットアップ

リポジトリの Settings → Pages からGitHub Pagesを有効化する。

![スクリーンショット 2024-10-12 14.27.43.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-12_14.27.43.png)

### baseUrlの変更

`vite.config.ts` の内容に baseを追加。

これは、GitHub Pagesでデプロイした場合のURLが [`https://ユーザー名.github.io/リポジトリ名`](https://ユーザー名.github.io/リポジトリ名) のような構造になっているためです。

```jsx
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig(({ command }) => ({
  plugins: [react()],
  base: command === 'serve' ? '/' : '/react-pokemon-zukan/',
}));
```

また、これに伴って、React Routerにも `basename`  のPropsを足してあげましょう。
`main.tsx` を以下のように書き換えてください。

`main.tsx` 

```jsx
**import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import App from './App';
import './index.css';

const queryClient = new QueryClient();

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter basename={import.meta.env.BASE_URL}>
        <App />
      </BrowserRouter>
    </QueryClientProvider>
  </React.StrictMode>
);**
```

### GitHub Actionsを使ったデプロイの設定

次に、プロジェクトのルートディレクトリに `.github/workflows/deploy.yml` を作成し、以下のように記述し、適切なコミットメッセージをつけてGitHubのリモートリポジトリにPushしましょう。
ちなみに、これはGitHub Actionsといい、GitHubのクラウド上でコマンド操作を可能にする仕組みです。チーム開発ではビルドチェックやテストなどによく利用されています。
また、アプリを公開することを「デプロイ」といいます。

`.github/workflows/deploy.yml`

```jsx
name: Deploy GitHub Pages

on:
  push:
    branches: ['main', 'master']

  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: 'pages'
  cancel-in-progress: true

jobs:
  build:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Pages
        uses: actions/configure-pages@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: npm install
      - name: Build
        run: npm ci && npm run build
        env:
          PUBLIC_URL: /react-pokemon-zukan
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: './dist'

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
```

リポジトリ名が `react-pokemon-zukan` となっていれば、
このGitHub Actionsは成功するはずなので、 GitHubリポジトリの Actionsのタブを見てみましょう。

以下のように、チェックマークがついていたら無事コマンドが通ってデプロイされています。

![スクリーンショット 2024-10-11 23.00.29.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-11_23.00.29.png)

画面の [pages build and deployment](https://github.com/wangchangdog/react-pokemon-zukan/actions/runs/11293421349) のリンク（枠部分）に進む。

次に、deployのタブに進む

![スクリーンショット 2024-10-11 23.04.41.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-11_23.04.41.png)

Complete jobの下の方にあるURLのリンクがデプロイ先のURLです。
これをクリックすると、アプリ画面が表示されるはずです。

![スクリーンショット 2024-10-11 23.06.24.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-11_23.06.24.png)

アプリ画面

![スクリーンショット 2024-10-11 23.09.47.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-11_23.09.47.png)

デプロイはこれで終わりです。

---

## 14. 状態管理とAPI連携(ここは読むだけ)

ReactHooksの説明

### React Hooksの導入と解説

React Hooksは、関数コンポーネント内で状態管理や副作用を扱うための仕組みです。以下では、基本的なHooksの使い方とカスタムフックの作成方法を解説します。

### useStateとuseEffectの基本

```tsx
import React, { useState, useEffect } from 'react';

const Example: React.FC = () => {
  const [count, setCount] = useState<number>(0);

  useEffect(() => {
    document.title = `Count: ${count}`;
  }, [count]);

  return (
    <div>
      <p>カウント: {count}</p>
      <button onClick={() => setCount(count + 1)}>カウントアップ</button>
    </div>
  );
};

export default Example;

```

### カスタムフックの作成

共通のロジックをカスタムフックとして抽出することで、再利用性を高めます。

```tsx
// src/hooks/usePokemon.ts
import { useQuery } from '@tanstack/react-query';
import { queryKeys } from '../queryKeys';
import { fetchPokemonListWithJapaneseNames } from '../api/pokemonWithJapaneseName';

export const usePokemonList = () => {
  return useQuery(queryKeys.pokemonList(), fetchPokemonListWithJapaneseNames);
};

```

### カスタムフックの使用例

```tsx
import React from 'react';
import { usePokemonList } from '../hooks/usePokemon';

const PokemonList: React.FC = () => {
  const { data, isLoading, error } = usePokemonList();

  if (isLoading) return <div>読み込み中...</div>;
  if (error instanceof Error) return <div>エラー: {error.message}</div>;

  return (
    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4">
      {data.map((pokemon) => (
        <PokemonCard key={pokemon.name} pokemon={pokemon} />
      ))}
    </div>
  );
};

export default PokemonList;

```

---

## 15. テストとデバッグの仕方(参考)

### 開発ツールの活用

開発中は、ブラウザの開発者ツールやReact DevToolsを活用してデバッグを行います。

### エラーハンドリングの実装

API呼び出し時のエラーハンドリングを適切に行い、ユーザーにフィードバックを提供します。

```tsx
if (isLoading) return <div>読み込み中...</div>;
if (error instanceof Error) return <div>エラー: {error.message}</div>;

```

### コンポーネントのテスト

JestやReact Testing Libraryを使用して、コンポーネントのユニットテストを実装します。

**インストール**

```bash
npm install --save-dev jest @testing-library/react @testing-library/jest-dom @types/jest

```

**テストの例**

```tsx
// src/components/__tests__/PokemonCard.test.tsx
import React from 'react';
import { render } from '@testing-library/react';
import PokemonCard from '../PokemonCard';
import { BrowserRouter } from 'react-router-dom';

test('ポケモンカードが正しくレンダリングされる', () => {
  const pokemon = {
    name: 'bulbasaur',
    url: '<https://pokeapi.co/api/v2/pokemon/1/>',
    japaneseName: 'フシギダネ',
  };

  const { getByText, getByAltText } = render(
    <BrowserRouter>
      <PokemonCard pokemon={pokemon} />
    </BrowserRouter>
  );

  expect(getByText('フシギダネ')).toBeInTheDocument();
  expect(getByAltText('フシギダネ')).toBeInTheDocument();
});

```

**設定ファイルの追加**

Jestを使用するために、`jest.config.js`をプロジェクトルートに追加します。

```jsx
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  moduleNameMapper: {
    '\\\\.(css|less|scss|sass)$': 'identity-obj-proxy',
  },
};

```

`jest.setup.js`を作成し、React Testing Libraryの設定を追加します。

```jsx
// jest.setup.js
import '@testing-library/jest-dom';

```

---

## 16. まとめ

本カリキュラムでは、TypeScript、React、Vite、React Router、Tailwind CSSなどの最新技術を使用して、ポケモン図鑑アプリを開発しました。以下のポイントを振り返りましょう。

- **プロジェクトのセットアップ**: Viteを使用して高速な開発環境を構築しました。
- **ルーティング**: React Routerを使用して、複数のページ間での遷移を実現しました。
- **スタイリング**: Tailwind CSSを使用して、効率的にレスポンシブデザインを実装しました。
- **データフェッチング**: Tanstack Queryを使用して、APIからのデータ取得とキャッシングを管理しました。
- **状態管理**: React Hooksを活用し、コンポーネントの状態を管理しました。
- **エラーハンドリングとテスト**: アプリケーションの信頼性を高めるために、エラーハンドリングとユニットテストを実施しました。
- **日本語名の取得**: PokeAPIの`species.url`から日本語名を動的に取得する方法を学びました。

---

## 17. 追加実装(早く終わった人)

以下を実装してみましょう。

- ナビゲーションメニューを作成する(以下のようなイメージ)
    
    ![スクリーンショット 2024-10-12 1.04.30.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-12_1.04.30.png)
    

- `PokemonList.tsx` の中でポケモンを絞り込むような仕組みを作成する(以下のようなイメージ)
    
    ![スクリーンショット 2024-10-12 1.05.12.png](React%20%E5%9F%BA%E7%A4%8E%E8%AC%9B%E5%BA%A7%5B%E3%83%9D%E3%82%B1%E3%83%A2%E3%83%B3%E5%9B%B3%E9%91%91%5D%20(%E6%94%B9%E8%A8%82)%201d224b6a67ce81b6be18f96130a9cad6/%25E3%2582%25B9%25E3%2582%25AF%25E3%2583%25AA%25E3%2583%25BC%25E3%2583%25B3%25E3%2582%25B7%25E3%2583%25A7%25E3%2583%2583%25E3%2583%2588_2024-10-12_1.05.12.png)
    
    - 絞り込む要素は、図鑑No、ポケモンの名前（日本語）、タイプなど…
- 参考のURL
    
    [LiveRally（ライブラリー）| 私だけの推し商品が見つかるライブコマース体験](https://live-rally.com/)
    

## 18. FAQ

### Q1. Viteとは何ですか？

**A1.** Viteは、フロントエンド開発のための高速なビルドツールで、モジュールのホットリロード（HMR）をサポートしています。ReactやTypeScriptとの相性が良く、迅速な開発体験を提供します。

### Q2. Tanstack QueryとAxiosの違いは何ですか？

**A2.** Tanstack Queryは、データの取得、キャッシング、同期を管理するライブラリであり、AxiosはHTTPクライアントライブラリです。Tanstack Queryは内部でfetch APIを使用するため、必ずしもAxiosは必要ありませんが、Axiosを使用することも可能です。

### Q3. shadcn/uiとは何ですか？

**A3.** shadcn/uiは、Tailwind CSSと統合されたUIコンポーネントライブラリで、再利用可能なスタイリング済みコンポーネントを提供します。

### Q4. 日本語対応のポケモン名を全て手動で追加するのは大変ですが、どうすれば効率的ですか？

**A4.** PokeAPIの`species.url`から動的に日本語名を取得する方法を実装することで、手動でのマッピングを避けることができます。具体的な実装方法については、[Zennの記事](https://zenn.dev/h_aso/articles/2220c857f5b74c)を参照してください。

### Q5. モバイルファーストデザインとは何ですか？

**A5.** モバイルファーストデザインは、まずモバイルデバイス向けにデザインを行い、その後に大きな画面向けに拡張していく設計手法です。これにより、ユーザー体験を最適化することができます。

---

## 19. ライセンス

本プロジェクトはMITライセンスのもとで公開されています。詳細については、LICENSEファイルをご覧ください。

---

## 20. トラブルシューティング

### 問題1. 開発サーバーが起動しない

**解決策:**

- `npm install`を再実行して依存関係を再インストールしてください。
- ポートが既に使用されていないか確認してください。
- ターミナルのエラーメッセージを確認し、必要な対応を行ってください。

### 問題2. APIからのデータ取得が失敗する

**解決策:**

- ネットワーク接続を確認してください。
- PokeAPIのステータスを確認してください（[PokeAPI Status](https://pokeapi.co/)）。
- CORSエラーが発生している場合は、プロキシの設定を検討してください。

### 問題3. TypeScriptの型エラーが発生する

**解決策:**

- 型定義が正しいか確認してください。
- 必要に応じて型アサーションを使用してください。
- 型定義ファイルを最新に保つために、`npm install @types/*`を実行してください。

### 問題4. Tailwind CSSのスタイルが適用されない

**解決策:**

- `tailwind.config.js`の`content`セクションに全てのコンポーネントファイルが含まれているか確認してください。
- 開発サーバーを再起動してください。

### 問題5. 日本語名が正しく表示されない

**解決策:**

- PokeAPIからのデータ取得が正しく行われているか確認してください。
- `fetchPokemonJapaneseName`関数が正しく日本語名を取得しているか確認してください。
- ブラウザの開発者ツールを使用して、APIレスポンスを確認してください。

### その他の問題

不明な問題が発生した場合は、公式ドキュメントやコミュニティフォーラムを参照してください。

---

以上が修正済みのカリキュラムです。ご不明点や追加の修正が必要な場合はお知らせください。