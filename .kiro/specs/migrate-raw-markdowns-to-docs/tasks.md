# 実装タスク計画

## 概要
`raw_markdowns` のMarkdownを `src/app/docs` 配下へ移行し、デモドキュメントを置換してサイト表示・検索・ナビゲーションを成立させる。コード変更は最小限とし、Markdoc/検索/レイアウトの既存仕組みに準拠する。

## マイルストーン
- M1: 解析と出力計画の確定（分割境界・スラッグ方針）
- M2: 自動移行スクリプトの実装（H1分割・Front Matter・リンク補正）
- M3: デモ置換と整合性チェック（ビルド/ナビ/検索）
- M4: ドキュメント整備と引き継ぎ

## タスク一覧（DoD/検証手順付き）

### T-01 リポ構造と前提の確認
- 内容: `src/app/docs` の既存構造、Markdoc設定、検索連携（`src/markdoc/search.mjs`）を再確認。
- DoD: 対象PATH/ファイル一覧と依存点を簡潔に記録。
- 検証: 一覧メモがチーム共有できる場所に保存されている。

### T-02 原本Markdownのインベントリ作成
- 内容: `raw_markdowns/**/*.md` を列挙し、各ファイルのH1（複数可）と先頭段落を抽出。
- DoD: ファイル→H1タイトル一覧（重複・空欄を含む）が出力される。
- 検証: 抽出レポートに件数合計と警告（H1欠落等）が含まれる。

### T-03 スラッグ生成ポリシー実装
- 内容: タイトル→ASCII `kebab-case` 変換（日本語は可能ならローマ字化→英数字以外除去→ハイフン区切り、重複は `-2`, `-3`）。
- DoD: 入力文字列に対する期待スラッグの単体テストケースを満たす。
- 検証: 衝突時に連番付与され、一意性が担保されるログが出る。

### T-04 ページ分割とFront Matter 生成
- 内容: H1ごとに `src/app/docs/<slug>/page.md` を生成。Front Matterに `title`, `description`（H1直後の段落要約）を付与。
- DoD: 全H1が1ページに対応し、ファイルが正しい場所に生成される。
- 検証: 生成ファイルを3件以上サンプル確認。Front Matterが期待どおり。

### T-05 本文・見出し・コード・画像の移送
- 内容: 対象H1配下本文をそのまま移送。コードブロックの空白・インデント維持。画像/添付は所定場所へコピーし参照更新。
- DoD: 最低1ファイルで画像/リンクを含むページが正しく表示される。
- 検証: `npm run dev` で対象ページをブラウザ確認し、レイアウト乱れ/404がない。

### T-06 内部リンクの相対パス補正
- 内容: 旧相対リンクを新スラッグ構造へ置換（同一サイト内リンク）。
- DoD: 置換件数がレポートされ、未解決リンクは0件（または明示リスト化）。
- 検証: ランダム3リンクのクリック遷移で目的ページに到達する。

### T-07 既存デモドキュメントの置換
- 内容: `src/app/docs` のデモ用ディレクトリを削除し、移行生成物で置き換え。
- DoD: デモ配下が残存しない（Git差分で確認）。
- 検証: サイトのナビゲーションに新ページのみが列挙される。

### T-08 検索インデックス・ナビゲーションの動作確認
- 内容: 検索UIから新コンテンツのヒットを確認。サイドバー/ToCの整合性確認。
- DoD: 代表キーワードで1件以上のヒットが返る。ToCがH2/H3を正しく示す。
- 検証: 目視で3ページ以上を確認し、リンク切れ・JSエラーなし。

### T-09 品質検証（ビルド・Lint）
- 内容: `npm run build` と `npm run lint` を実行し、エラー/警告の有無を確認。
- DoD: ビルド成功、Lintエラーなし（プロジェクト既存ルール準拠）。
- 検証: コマンド出力ログを保存。

### T-10 ドキュメント整備・引き継ぎ
- 内容: READMEまたは運用メモに「コンテンツ追加手順」「スラッグ規約」「Front Matter規約」「画像配置ルール」を追記。
- DoD: 新規貢献者が規約に従って1ページ追加できる状態。
- 検証: 手順に沿ってダミーページを1件追加し、表示・検索を確認。

## リスクと対策
- タイトル欠落/非ASCIIのみ: ファイル名から仮タイトル生成し `[Untitled]` 付与（T-03/T-04で処理）。
- 大型Markdownの長ページ化: 初回はH1単位、閲覧性に問題あればH2分割の追加タスク化。
- 相対リンク複雑性: 置換マップをログ出力し、人手検証の対象を明確化。

## 作業順序（依存関係）
T-01 → T-02 → T-03 → T-04 → T-05 → T-06 → T-07 → T-08 → T-09 → T-10

## 完了の定義（全体）
- `src/app/docs` 直下が移行後のページのみとなり、ブラウザ閲覧・検索・ナビゲーション・ToCが機能する。
- `npm run build` および `npm run lint` が成功する。
- コンテンツ追加ガイドが整備されている。
